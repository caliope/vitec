<!DOCTYPE html>
<html>
<head>
    <title>VITEC</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style/w2ui-1.4.3.min.css">
    <script src="/scripts/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/scripts/w2ui-1.4.3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/scripts/chart.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body  style="margin: 0px;">
    <div id="layout" style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;"></div>
</body>
<script>
$(document).ready(function() {
	var pstyle = 'background-color: #f1f1f1; border: 1px solid #dfdfdf; padding: 5px;';
	$('#layout').w2layout({
        name: 'main_layout',
        panels: [
            { type: 'top', 
              	size: 30, 
              	resizable: false, 
              	style: pstyle , 
              	toolbar: {
              		items: [
              			{ id: 'login', type: 'button', caption: 'Login' }
                	],
                	onClick: function (event) {
            			if (event.target == "login") {
            				openPopUpLogin();
            			};
            		}
        		}
            },
            { type: 'main', 
                style: pstyle
            }
        ]
    });
});

function openPopUpLogin () {
    if (!w2ui.loginform) {
        $().w2form({
            name: 'loginform',
            style: 'border: 0px; background-color: transparent;',
            formHTML: 
                '<div class="w2ui-page page-0"> \
                    <div class="w2ui-field"> \
                        <label>Correo:</label> \
                        <div> \
                           <input name="usuario" type="text" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                    <div class="w2ui-field"> \
                        <label>Contraseña:</label> \
                        <div> \
                            <input name="contrasena" type="password" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                    <a href="" onClick="openPopUpRegistro(); return false;">Registrarse</a> \
                </div> \
                <div class="w2ui-buttons"> \
                    <button class="btn" name="ok">Login</button> \
                </div>',
            fields: [
                { field: 'usuario', type: 'text', required: true },
                { field: 'contrasena', type: 'text', required: true }
            ],
            actions: {
                "ok": function () { 
                	this.validate();
                	$.post('/usuarios.php', {email: this.record.usuario, contrasena: this.record.contrasena, autenticar: 1}).
                	done(function (datos) {
                		w2popup.close();
                		w2ui['main_layout_top_toolbar'].remove('login');
                		w2ui['main_layout_top_toolbar'].add([
                			{ id: 'salir', type: 'button', caption: 'Salir' }
                		]);
                		w2ui['main_layout'].panels[2].size=250;
                		w2ui['main_layout'].panels[2].resizable=true;
                		w2ui['main_layout'].show('left');
                	});
                },
            }
        });
    }
    $().w2popup('open', {
        title   : 'Autenticación',
        body    : '<div id="form" style="width: 100%; height: 100%;"></div>',
        style   : 'padding: 15px 0px 0px 0px',
        width   : 500,
        height  : 220, 
        showMax : false,
        modal	: true,
        onToggle: function (event) {
            $(w2ui.loginform.box).hide();
            event.onComplete = function () {
                $(w2ui.loginform.box).show();
                w2ui.loginform.resize();
            }
        },
        onOpen: function (event) {
            event.onComplete = function () {
                $('#w2ui-popup #form').w2render('loginform');
            }
        }
    });
}

function openPopUpRegistro () {
	w2popup.close();
	if (!w2ui.registroform) {
        $().w2form({
            name: 'registroform',
            style: 'border: 0px; background-color: transparent;',
            formHTML: 
                '<div class="w2ui-page page-0"> \
                    <div class="w2ui-field"> \
                        <label>Nombres:</label> \
                        <div> \
                           <input name="nombres" type="text" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                    <div class="w2ui-field"> \
                        <label>Apellidos:</label> \
                        <div> \
                           <input name="apellidos" type="text" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                    <div class="w2ui-field"> \
                        <label>Correo:</label> \
                        <div> \
                           <input name="usuario" type="text" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                    <div class="w2ui-field"> \
                        <label>Contraseña:</label> \
                        <div> \
                            <input name="contrasena" type="password" maxlength="100" style="width: 250px"/> \
                        </div> \
                    </div> \
                </div> \
                <div class="w2ui-buttons"> \
                    <button class="btn" name="cancel">Cancelar</button> \
                    <button class="btn" name="grabar">Grabar</button> \
                </div>',
            fields: [
                { field: 'usuario', type: 'text', required: true },
                { field: 'contrasena', type: 'text', required: true }
            ],
            actions: {
                "cancel": function () { w2popup.close(); },
                "grabar": function () { this.validate(); },
            }
        });
    }
    $().w2popup('open', {
        title   : 'Registro',
        body    : '<div id="form" style="width: 100%; height: 100%;"></div>',
        style   : 'padding: 15px 0px 0px 0px',
        width   : 500,
        height  : 290, 
        showMax : false,
        modal	: true,
        onToggle: function (event) {
            $(w2ui.registroform.box).hide();
            event.onComplete = function () {
                $(w2ui.registroform.box).show();
                w2ui.registroform.resize();
            }
        },
        onOpen: function (event) {
            event.onComplete = function () {
                $('#w2ui-popup #form').w2render('registroform');
            }
        }
    });
}

</script>
</html>